<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Marco L√≥gico - Entrada</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="robots" content="noindex">
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--hb-green:#1E7E34;--hb-accent:#FFC857;--ink:#1b1b1b;--bg:#fafafa;--muted:#667085}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:900px;margin:0 auto;padding:20px}
    header{text-align:center;padding-top:28px;margin-bottom:40px}
    .brand{display:inline-flex;align-items:center;gap:12px;justify-content:center}
    .logo{width:100px;height:auto}
    h1{margin:10px 0 6px;font-size:26px}
    p.lead{color:var(--muted);margin:0 0 10px}
    form{background:#fff;border:1px solid #eee;border-radius:12px;padding:30px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .form-section{margin-bottom:32px}
    .form-section h2{font-size:18px;font-weight:600;margin:0 0 20px;color:var(--ink);border-bottom:2px solid var(--hb-green);padding-bottom:10px}
    label{display:block;margin:16px 0 6px;font-weight:600;color:var(--ink)}
    input,textarea,select{width:100%;margin-top:6px;border:1px solid #d8dee4;border-radius:8px;padding:12px;font:inherit;line-height:1.5}
    textarea{resize:vertical;min-height:100px}
    .note{font-size:12px;color:#80888c;margin-top:6px}
    .info-box{background:#f0f7f4;border-left:4px solid var(--hb-green);padding:12px;border-radius:6px;margin:12px 0;font-size:13px;color:var(--ink)}
    .buttons{display:flex;gap:12px;margin-top:30px}
    button{background:var(--hb-green);color:#fff;border:0;border-radius:10px;padding:12px 24px;font-weight:600;cursor:pointer;transition:all 0.2s;font-size:16px;flex:1}
    button:hover:not(:disabled){filter:brightness(1.05)}
    button:disabled{opacity:0.6;cursor:not-allowed}
    .status{min-height:22px;color:var(--muted);margin:16px 0 0;font-size:14px}
    .status.error{color:#d32f2f}
    .status.success{color:var(--hb-green)}
    footer{color:#80888c;font-size:12px;text-align:center;padding:24px 0}

    .objetivos-section{display:none;margin-top:30px}
    .objetivos-section.ativa{display:block}
    .objetivo-input-group{background:#f9f9f9;border:1px solid #e3e8ee;border-radius:8px;padding:16px;margin:12px 0}
    .objetivo-input-group h4{margin:0 0 12px;color:var(--hb-green);font-size:14px}
    .objetivo-input-group input{margin-bottom:12px}
    .objetivo-input-group textarea{min-height:80px}

    .contador{display:inline-block;background:var(--hb-accent);color:#111;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;margin-left:8px}
    .loading-spinner{display:inline-block;width:16px;height:16px;border:2px solid #e3e8ee;border-top:2px solid var(--hb-green);border-radius:50%;animation:spin 0.8s linear infinite;margin-left:8px}
    @keyframes spin{0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <header class="wrap">
    <div class="brand">
      <img src="./Humana Logo.png" alt="Humana Logo" class="logo">
      <strong>Humana Povo para Povo Brasil</strong>
    </div>
    <h1>üéØ Marco L√≥gico</h1>
    <p class="lead">Criar um marco l√≥gico completo para seu projeto</p>
  </header>

  <main class="wrap">
    <form id="marcoForm" novalidate>
      
      <!-- SE√á√ÉO 1: Objetivo Geral -->
      <div class="form-section">
        <h2>üéØ Objetivo Geral</h2>
        <label>Qual √© o objetivo geral do seu projeto? *
          <textarea name="objetivo_geral" id="objetivoGeral" required placeholder="Ex: Transformar o turismo na Ilha do Bananal em motor de regenera√ß√£o ecol√≥gica e sociocultural, assegurando renda digna √†s comunidades"></textarea>
          <div class="note">Descreva de forma clara e concisa o resultado principal que seu projeto quer alcan√ßar</div>
        </label>
      </div>

      <!-- SE√á√ÉO 2: N√∫mero de Objetivos -->
      <div class="form-section">
        <h2>üìä Estrutura do Marco</h2>
        <label>Quantos Objetivos Espec√≠ficos seu projeto ter√°? *
          <select name="num_objetivos" id="numObjetivos" required>
            <option value="">Selecione...</option>
            <option value="1">1 objetivo</option>
            <option value="2">2 objetivos</option>
            <option value="3">3 objetivos</option>
            <option value="4">4 objetivos</option>
            <option value="5">5 objetivos</option>
            <option value="6">6 objetivos</option>
            <option value="7">7 objetivos</option>
          </select>
          <div class="note">Escolha quantos pilares principais seu projeto ter√°</div>
        </label>
      </div>

      <!-- SE√á√ÉO 3: Preencher Objetivos Espec√≠ficos -->
      <div class="form-section objetivos-section" id="objetivosSection">
        <h2>üìå Objetivos Espec√≠ficos <span class="contador" id="contadorOE">0</span></h2>
        <p style="color:var(--muted);font-size:13px">Preencha cada objetivo espec√≠fico que deseja incluir no marco l√≥gico. A IA gerar√° automaticamente os resultados, indicadores e atividades para cada um.</p>
        <div id="objetivosContainer"></div>
      </div>

      <!-- SE√á√ÉO 4: Contexto -->
      <div class="form-section">
        <h2>‚úèÔ∏è Contexto do Projeto</h2>
        <label>Contexto, desafios e pressupostos (opcional)
          <textarea name="contexto" placeholder="Descreva brevemente o contexto do projeto, principais desafios, e fatores externos que podem afetar o sucesso. Isso ajudar√° a IA a personalizar melhor os marcos l√≥gicos."></textarea>
          <div class="note">Quanto melhor o contexto, melhor a IA personalizar√° o marco l√≥gico</div>
        </label>
      </div>

      <div class="info-box">
        <strong>üí° Como funciona:</strong><br>
        1. Voc√™ preenche o Objetivo Geral e os Objetivos Espec√≠ficos<br>
        2. A IA gera automaticamente 2-3 Resultados por Objetivo<br>
        3. Para cada Resultado: 3 Indicadores SMART + 2-5 Atividades<br>
        4. Tudo pronto em um arquivo Excel profissional!
      </div>

      <!-- BOT√ïES -->
      <div style="text-align:center;margin-top:30px">
        <button type="submit" id="submitBtn">üöÄ Gerar Marco L√≥gico</button>
        <p id="status" class="status" role="status" aria-live="polite"></p>
      </div>

    </form>
  </main>

  <footer>¬© Humana Povo para Povo Brasil | Marco L√≥gico</footer>

  <script>
    const form = document.getElementById('marcoForm');
    const numObjetivosSelect = document.getElementById('numObjetivos');
    const objetivosSection = document.getElementById('objetivosSection');
    const objetivosContainer = document.getElementById('objetivosContainer');
    const contadorOE = document.getElementById('contadorOE');
    const statusEl = document.getElementById('status');

    // Quando mudar n√∫mero de objetivos, gerar campos de entrada
    numObjetivosSelect.addEventListener('change', (e) => {
      const numObjetivos = parseInt(e.target.value) || 0;
      
      if (numObjetivos > 0) {
        objetivosSection.classList.add('ativa');
        contadorOE.textContent = numObjetivos;
        renderizarCamposObjetivos(numObjetivos);
      } else {
        objetivosSection.classList.remove('ativa');
        objetivosContainer.innerHTML = '';
      }
    });

    function renderizarCamposObjetivos(num) {
      objetivosContainer.innerHTML = '';
      
      for (let i = 1; i <= num; i++) {
        const div = document.createElement('div');
        div.className = 'objetivo-input-group';
        
        div.innerHTML = `
          <h4>Objetivo Espec√≠fico ${i}</h4>
          <input 
            type="text" 
            name="oe_titulo_${i}" 
            placeholder="T√≠tulo do objetivo (ex: Fortalecer Capacidades Comunit√°rias)"
            required
          >
          <textarea 
            name="oe_descricao_${i}" 
            placeholder="Descri√ß√£o breve do que ser√° alcan√ßado com este objetivo"
            required
          ></textarea>
        `;
        
        objetivosContainer.appendChild(div);
      }
    }

    // Enviar formul√°rio DIRETO para Claude via webhook
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span>‚è≥ Gerando Marco L√≥gico...</span><div class="loading-spinner"></div>';
      statusEl.textContent = '';
      statusEl.classList.remove('error', 'success');

      try {
        const objetivoGeral = form.objetivo_geral.value.trim();
        const numObjetivos = parseInt(form.num_objetivos.value);
        const contexto = form.contexto.value.trim();

        if (!objetivoGeral || !numObjetivos) {
          throw new Error('Por favor, preencha o Objetivo Geral e selecione o n√∫mero de objetivos');
        }

        // Coletar Objetivos Espec√≠ficos preenchidos
        const objetivosEspecificos = [];
        for (let i = 1; i <= numObjetivos; i++) {
          const titulo = form[`oe_titulo_${i}`].value.trim();
          const descricao = form[`oe_descricao_${i}`].value.trim();
          
          if (!titulo || !descricao) {
            throw new Error(`Por favor, preencha o Objetivo Espec√≠fico ${i}`);
          }

          objetivosEspecificos.push({
            numero: i,
            titulo: titulo,
            descricao: descricao
          });
        }

        // Preparar dados para enviar direto para Claude
        const payload = {
          objetivo_geral: objetivoGeral,
          num_objetivos: numObjetivos,
          objetivos_especificos: objetivosEspecificos,
          contexto: contexto
        };

        console.log('üì§ Enviando para Claude via Webhook:', payload);

        // WEBHOOK URL - APONTA DIRETO PARA CLAUDE
        // Configurar em Make.com: Webhook ‚Üí Claude
        const WEBHOOK_URL = 'https://hook.us2.make.com/6lkkytmbws4tvlep6aquy1yvt2l0glwm';

        statusEl.textContent = '‚è≥ Processando com IA (pode levar 2-3 minutos)...';
        statusEl.classList.add('success');

        const response = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error(`Erro na comunica√ß√£o: ${response.status}`);
        }

        let responseText = await response.text();
        console.log('üì• Resposta recebida');

        // Parse JSON (limpar markdown se necess√°rio)
        let marcoLogico;
        try {
          marcoLogico = JSON.parse(responseText);
        } catch (e) {
          let cleanJson = responseText
            .replace(/```json\n?/g, '')
            .replace(/```\n?/g, '')
            .trim();
          marcoLogico = JSON.parse(cleanJson);
        }

        console.log('‚úÖ Marco L√≥gico gerado:', marcoLogico);

        // Salvar em sessionStorage
        sessionStorage.setItem('marcoLogico', JSON.stringify(marcoLogico));
        sessionStorage.setItem('marcoData', JSON.stringify(payload));

        statusEl.textContent = '‚úÖ Marco L√≥gico gerado! Redirecionando...';
        statusEl.classList.remove('success');
        statusEl.classList.add('success');

        // Redirecionar para visualiza√ß√£o
        setTimeout(() => {
          window.location.href = 'marco-logico-simples-tela-resultado.html';
        }, 1500);

      } catch (err) {
        console.error('‚ùå ERRO:', err);
        statusEl.textContent = `‚ùå Erro: ${err.message}`;
        statusEl.classList.add('error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'üöÄ Gerar Marco L√≥gico';
      }
    });

  </script>

</body>
</html>
